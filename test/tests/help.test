#!/usr/bin/env bash

PATH=$PWD/fixtures/help:${PATH}
output=$(mktemp)
trap "rm -r -- '${output}'" EXIT

test-command-help() {
  cli basic --help &> "${output}"
  diff "${output}" - <<EOF
Usage:
cli basic [ OPTIONS ]

Command description first line.  Command description second line.  Command
description third line with trailing newlines.

Options:
--boolean, -b
  Boolean option description.

--enum, -e ENUM-VALUE
  Enum option description with trailing newlines.

--multi, -m MULTI-VALUE
  Multi option description.

--primary
  Primary option description.

--single, -s SINGLE-VALUE
  Single option first line.  Single option second line.  Single option
  third line.

--help
  Shows a help message.

Subcommands:
subcommand-0    Subcommand-0 description.
subcommand-1    Subcommand-1 description.
EOF
}

test-subcommand-help() {
  cli basic subcommand-0 --help &> "${output}"
  diff "${output}" - <<EOF
Usage:
cli basic subcommand-0 [ OPTIONS ]

Subcommand-0 description.

Options:
--help
  Shows a help message.
EOF
}

test-one-parameter-help() {
  cli one-parameter --help &> "${output}"
  diff "${output}" - <<EOF
Usage:
cli one-parameter [ OPTIONS ] PARAMETER-0-TYPE

Options:
--help
  Shows a help message.
EOF
}

test-two-parameters-help() {
  cli two-parameters --help &> "${output}"
  diff "${output}" - <<EOF
Usage:
cli two-parameters [ OPTIONS ] PARAMETER-0-TYPE PARAMETER-1-TYPE

Options:
--help
  Shows a help message.
EOF
}

test-unlimited-parameters-help() {
  cli unlimited-parameters --help &> "${output}"
  diff "${output}" - <<EOF
Usage:
cli unlimited-parameters [ OPTIONS ] PARAMETER-0-TYPE PARAMETER-1-TYPE PARAMETER-N-TYPE ...

Options:
--help
  Shows a help message.
EOF
}

test-too-many-parameters-help() {
  cli too-many-parameters --help &> "${output}"
  diff "${output}" - <<EOF
[warn] max parameter count exceeded: 8
Usage:
cli too-many-parameters [ OPTIONS ] VALUE-TYPE ...

Options:
--help
  Shows a help message.
EOF
}

. ./lib/run-tests
