#!/usr/bin/env bash
# shellcheck disable=SC2064,SC1091

PATH=$PWD/fixtures/options:${PATH}
output=$(mktemp)
trap "rm -r -- '${output}'" EXIT

test-no-options() {
  cli &> "${output}"
  diff "${output}" - <<EOF
boolean=
single=
enum=
EOF
}

test-boolean-option() {
  cli --boolean &> "${output}"
  diff "${output}" - <<EOF
boolean=true
single=
enum=
EOF
}

test-single-option() {
  cli --single 0 &> "${output}"
  diff "${output}" - <<EOF
boolean=
single=0
enum=
EOF
}

test-multi-option() {
  cli --multi a --multi b &> "${output}"
  diff "${output}" - <<EOF
boolean=
single=
multi[0]=a
multi[1]=b
enum=
EOF
}

test-enum-option() {
  cli --primary &> "${output}"
  diff "${output}" - <<EOF
boolean=
single=
enum=primary
EOF
}

test-alias-options() {
  cli -b -s a -m a -m b -e primary &> "${output}"
  diff -u "${output}" - <<EOF
boolean=true
single=a
multi[0]=a
multi[1]=b
enum=primary
EOF
}

test-concatenated-options() {
  cli -bs a -bbm a &> "${output}"
  diff -u "${output}" - <<EOF
boolean=true
single=a
multi[0]=a
enum=
EOF
}

test-parameter-option() {
  cli a b &> "${output}"
  diff "${output}" - <<EOF
boolean=
single=
enum=
parameter[0]=a
parameter[1]=b
EOF
}

test-unknown-option() {
  cli --no-such-option &> "${output}" && return 1
  diff "${output}" - <<EOF
[error] unrecognized option: --no-such-option
EOF
}

test-single-requires-argument() {
  cli --single &> "${output}" && return 1
  diff "${output}" - <<EOF
[error] option requires an argument: --single
EOF
}

test-multi-requires-argument() {
  cli --multi &> "${output}" && return 1
  diff "${output}" - <<EOF
[error] option requires an argument: --multi
EOF
}

. ./lib/run-tests
