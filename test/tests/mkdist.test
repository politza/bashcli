#!/usr/bin/env bash

PATH=$PWD/../bin:${PATH}
output=$(mktemp)
dist=$(mktemp -d)
trap "rm -r -- '${output}' '${dist}'" EXIT RETURN
export XDG_CACHE_HOME=${dist}/.cache

test-dist-with-symlink() {
  local distDir=${dist}/symlink
  mkdist ./fixtures/options/cli "${distDir}"
  "${distDir}"/cli --primary &> "${output}"
  diff "${output}" - <<EOF
enum=primary
EOF
}

test-dist-with-script() {
  local distDir=${dist}/script
  mkdist ./fixtures/script-cli/cli "${distDir}"
  "${distDir}"/cli command a b c &> "${output}"
  diff "${output}" - <<EOF
a
b
c
EOF
}

. ./lib/run-tests
