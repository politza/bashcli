#!/usr/bin/env bash

PATH=$PWD/fixtures/options-multi-csv:${PATH}
output=$(mktemp)
trap "rm -r -- '${output}'" EXIT

test-multi-csv-single-option() {
  cli --multi-csv a &> "${output}"
  diff "${output}" - <<EOF
multi[0]=a
EOF
}

test-multi-csv-multiple-options() {
  cli --multi-csv=a,b,c &> "${output}"
  diff "${output}" - <<EOF
multi[0]=a
multi[1]=b
multi[2]=c
EOF
}

test-multi-csv-multiple-options-multiple-times() {
  cli --multi-csv a,b,c --multi-csv=d,e,f &> "${output}"
  diff "${output}" - <<EOF
multi[0]=a
multi[1]=b
multi[2]=c
multi[3]=d
multi[4]=e
multi[5]=f
EOF
}

test-multi-csv-multiple-options-aliased() {
  cli -ma,b,c &> "${output}"
  diff "${output}" - <<EOF
multi[0]=a
multi[1]=b
multi[2]=c
EOF
}

test-multi-csv-multiple-options-whitespace() {
  cli --multi-csv=' a,  b,   c' &> "${output}"
  diff "${output}" - <<EOF
multi[0]= a
multi[1]=  b
multi[2]=   c
EOF
}

. ./lib/run-tests
