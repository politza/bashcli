#!/usr/bin/env bash

PATH=${PWD}/fixtures/cache:${PATH}
output=$(mktemp)
cache=$(mktemp -d)
trap "rm -r -- '${output}' '${cache}'" EXIT
export BASHCLI_CACHE_DIR=${cache}/.cache

after-each() {
  rm -rf -- "${BASHCLI_CACHE_DIR}"
}

test-cache-miss() {
  cli get namespace key &> "${output}" && return 1
  [ "$(stat -c%s "${output}")" -eq 0 ]
}

test-cache-put() {
  cli put namespace key value
  cli get namespace key &> "${output}"
  diff "${output}" - < <(printf value)
}

test-cache-namespace() {
  cli put namespace key value
  cli get other key &> "${output}" && return 1
  [ "$(stat -c%s "${output}")" -eq 0 ]
}

. ./lib/run-tests
