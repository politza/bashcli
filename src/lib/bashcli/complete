#!/usr/bin/env bash

bashcli-complete-directory() {
  _comp_compgen_filedir -d
}

bashcli-complete-file() {
  _comp_compgen_filedir
}

bashcli-complete-config-profile() {
  bashcli-config-initialize

  if bashcli-shell-is-function _comp_delimited && [ "${BASHCLI_COMPLETION_OPTION_TYPE}" == multi ]; then
    ! _comp_delimited , -W '"${!BASHCLI_CONFIG_PROFILES[@]}"'
  else
    COMPREPLY=("${!BASHCLI_CONFIG_PROFILES[@]}")
  fi

  return 0
}

bashcli-complete-config-property() {
  bashcli-config-initialize

  COMPREPLY=("${!BASHCLI_CONFIG_PROPERTIES[@]}")
}

bashcli-complete-subcommand() {
  local commandList=("$@")
  local completion subcommand commandMain

  if bashcli-command-subcommands "${commandList[@]}"; then
    for subcommand in "${REPLY[@]}"; do
      if bashcli-command-resolve "${commandList[@]}" "${subcommand}"; then
        local commandMain=${REPLY}
        bashcli-context-read "${commandList[@]}" "${subcommand}" || continue
        completion=${BASHCLI_CONTEXT_DESCRIPTIONS[${commandMain}]}
        bashcli-string-trim completion
        # shellcheck disable=SC2034
        BASHCLI_COMPLETIONS["${subcommand}"]=${completion%%$'\n'*}
      fi
    done
    return 0
  fi
  return 1
}
